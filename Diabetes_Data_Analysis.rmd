---
title: "Health Indications for Diabetes - Data Visualization"
author: "Cassandra Ortiz-Nelsen"
date: "2025-11-05"
output: html_document
---
<style>
/* Make the entire report use Times New Roman, increase font size to 18px */
body, p, li, table, td, th {
  font-family: "Times New Roman", Times, serif;
  font-size: 18px;
}

/* Make all headers bold and larger (Titles) */
h1, h2, h3, h4 {
  font-family: "Times New Roman", Times, serif;
  font-weight: bold;
}

/* Box around data/output */
.data-box {
  border: 2px solid #4B0082;
  border-radius: 10px;
  background-color: #f9f9ff;
  padding: 15px;
  margin: 15px 0;
  font-size: 16px; /* slightly smaller than body for clarity */
  font-family: "Times New Roman", Times, serif;
}
pre, code {
  font-family: Consolas, "Courier New", monospace;
}
</style>

```{r setup, load-csv, include=FALSE} 
here::i_am("Diabetes_Data_Analysis.rmd")

data <- read.csv(here::here("code/raw_diabetes_dataset.csv"), header = TRUE) 
library(knitr)
library(tidyverse) 
library(dplyr) 
library(gtsummary) 
library(labelled)
library(ggplot2)

# Wes Anderson palette (The Grand Budapest Hotel)
wes_colors <- c("#FAD089", "#FF9C5B", "#F5634A", "#ED303C", "#3B8183")
knitr::opts_chunk$set( 
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)
```

# Introduction
The dataset, "Diabetes Dataset: Predicting Diabetes Onset Based on Diagnostic Measures" is a very useful and popular tool for machine learning and health research pertaining to health indicators so health professionals can better predict this disease. This report illustrates that with robust datasets, helpful charts and cross-tabulations are possible to visualize data and make decisions.

# Information about the Data
This data set includes data from 768 female patient records, adapted from the National Institute of Diabetes and Digestive and Kidney Diseases (NIDDK). It provides insight for variables such as: age, BMI, glucose, blood pressure, and insulin. 

This data can indicate whether a patient is more at risk for diabetes based on the limits acknowledged by physicians, further, this data set provides insight into prevention thresholds which is clinically meaningful. The data collected has an array of variables, yet is simple to work with in order to discover risk patterns.

The participants range in age, with most participants 30-50 years of age. For glucose and BMI patterns, there are very clear differences when comparing which groups of participants suffer diabetes onset. Of course, BMI has been a diabetes indicator and will be modeled in this report. 

To speak briefly on less discussed health indicators, such as skin thickness, blood pressure, and insulin, it is  harder to attribute a clear pattern, and have shown to be difficult disease-indicators although still useful to some degree. 

A note on the participant health outcome distribution, this data is mostly balanced with ~35% with outcome and ~65% without. This means the data set is robust, reducing bias.

A cross tabulation analysis was run to illustrate the relationship between diabetes and BMI. This cross-tabulation clearly shows that with a greater prevalence of diabetes, the patients will most likely be on the higher end of the BMI range. Further, when someone is in the danger zone of the BMI range, they can start to take action to prevent diabetes if informed in time.


# Variable Definitions
Pregnancies: Number of times the patient has been pregnant.

Glucose: Plasma glucose concentration after a 2-hour oral glucose tolerance test.

BloodPressure: Diastolic blood pressure (mm Hg).

SkinThickness: Triceps skinfold thickness (mm).

Insulin: 2-hour serum insulin (mu U/ml).

BMI: Body mass index (weight in kg/(height in m)^2).

DiabetesPedigreeFunction: A function representing the patientâ€™s diabetes pedigree (likelihood based on family history).

Age: Age of the patient (years).

Outcome: Binary outcome indicating the presence (1) or absence (0) of diabetes.

Here is the link to the dataset: https://www.kaggle.com/datasets/hasibur013/diabetes-dataset

# Analysis Objectives
1.Summarize and model the distribution of important diagnostic health indicators.


2.Explore relationships between predictors (such as glucose, BMI, or age) and diabetes.


3.Build a reproducible workflow for exploratory data analysis for later predictive analytics in hospitals

# Sample of Data
```{r, load-data}
glimpse(data)
```

```{r}

var_label(data) <- list(
  Pregnancies = "Pregnancies",
  Glucose = "Glucose",
  BloodPressure = "Blood Pressure",
  SkinThickness = "Skin Thickness",
  Insulin = "Insulin",
  BMI = "BMI",
  DiabetesPedigreeFunction = "Diabetes Pedigree Function",
  Age = "Age",
  Outcome = "Outcome"
)
#create descriptive table
tbl_summary(data) %>% bold_labels()
```
# BMI and Glucose Distribution

```{r}
ggplot(data, aes(x = Glucose)) +
  geom_histogram(binwidth = 10, fill = wes_colors[3], color = wes_colors[4], alpha = 0.8) +
  labs(
  title = "Distribution of Plasma Glucose Concentrations", subtitle = "Frequency of glucose values among study participants n=768", 
       x = "Glucose (mg/dL)", 
       y = "Frequency") +
         theme_minimal(base_family = "Times New Roman") +
  theme(
    plot.title = element_text(face = "bold"),
    plot.subtitle = element_text(face = "italic")
  )

ggplot(data, aes(x = BMI)) +
  geom_histogram(binwidth = 2, fill = wes_colors[2], color = wes_colors[4], alpha = 0.8) +
  labs(
    title = "Distribution of Body Mass Index (BMI)",
    subtitle = "Frequency of BMI measurements across all study participants",
    x = "BMI (kg/m^2)",
    y = "Frequency",
  ) +
    theme_minimal(base_family = "Times New Roman") +
  theme(
    plot.title = element_text(face = "bold"),
    plot.subtitle = element_text(face = "italic")
  )
```

```{r}
# Diabetes Onset Outcome
ggplot(data, aes(x = factor(Outcome, labels = c("0 = No Diabetes", "1 = Diabetes")), 
                 fill = factor(Outcome, labels = c("0 = No Diabetes", "1 = Diabetes")))) +
  geom_bar(alpha = 0.8) +
  scale_fill_manual(values = c("0 = No Diabetes" = wes_colors[1], 
                               "1 = Diabetes" = wes_colors[4])) +
  labs(
    title = "Distribution of Diabetes Outcomes",
    subtitle = "Number of participants with and without diabetes (n = 768)",
    x = "Diabetes Status",
    y = "Number of Participants",
    fill = "Diabetes Status"
  ) +
  theme_minimal(base_family = "Times New Roman") +
  theme(
    plot.title = element_text(face = "bold", size = 18),
    plot.subtitle = element_text(face = "italic", size = 14),
    axis.title = element_text(face = "bold", size = 14),
    axis.text = element_text(size = 12),
    legend.title = element_text(face = "bold", size = 14),
    legend.text = element_text(size = 12)
  )
```

```{r}
#visual elements
ggplot(data, aes(x = Glucose, y = BMI, color = factor(Outcome, labels = c("0 = No Diabetes", "1 = Diabetes")))) + 
  geom_point(alpha = 0.7, size = 2) + 
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed") + 
  scale_color_manual(values = c("0 = No Diabetes" = wes_colors[2], "1 = Diabetes" = wes_colors[5])) + 
  labs(
    title = "Relationship Between Plasma Glucose and BMI by Diabetes Status",
    subtitle = "Higher glucose levels are associated with elevated BMI among diabetes-positive participants",
    x = "Plasma Glucose (mg/dL)",
    y = "BMI (kg/m^2)",
    color = "Diabetes Status"
  ) +
  theme_minimal(base_family = "Times New Roman") +
  theme(
    plot.title = element_text(face = "bold"),
    legend.title = element_text(face = "bold")
  )
```

```{r}
#outcome distribution table
outcome_table <- data %>%
count(Outcome) %>%
mutate(
Percent = round(n / sum(n) * 100, 1),
Outcome = ifelse(Outcome == 1, "Diabetes", "No Diabetes")
)

kable(outcome_table, caption = "Distribution of Diabetes Outcomes (0 = No, 1 = Yes)")

#BMI categories
data <- data %>%
mutate(
BMI_Category = case_when(
BMI < 18.5 ~ "Underweight",
BMI >= 18.5 & BMI < 25 ~ "Normal",
BMI >= 25 & BMI < 30 ~ "Overweight",
BMI >= 30 ~ "Obese"
)
)


```

```{r}
#glucose by outcome
ggplot(data, aes(x = factor(Outcome, labels = c("0 = No Diabetes", "1 = Diabetes")), y = Glucose, fill = factor(Outcome, labels = c("0 = No Diabetes", "1 = Diabetes")))) +
  geom_boxplot(alpha = 0.8) +
  scale_fill_manual(values = c("0 = No Diabetes" = wes_colors[5], "1 = Diabetes" = wes_colors[4])) +
  labs(
    title = "Boxplot of Glucose Levels by Diabetes Outcome",
    subtitle = "Participants with diabetes show higher median glucose concentrations",
    x = "Diabetes Status",
    y = "Plasma Glucose (mg/dL)",
    fill = "Diabetes Status"
  ) +
  theme_minimal(base_family = "Times New Roman") +
  theme(
    plot.title = element_text(face = "bold"),
    legend.title = element_text(face = "bold")
  )

#BMI by outcome
ggplot(data, aes(x = factor(Outcome, labels = c("0 = No Diabetes", "1 = Diabetes")), y = BMI, fill = factor(Outcome, labels = c("0 = No Diabetes", "1 = Diabetes")))) +
  geom_boxplot(alpha = 0.8) +
  scale_fill_manual(values = c("0 = No Diabetes" = wes_colors[5], "1 = Diabetes" = wes_colors[4])) +
  labs(
    title = "BMI by Diabetes Outcome",
    x = "Diabetes Status",
    y = "Body Mass Index (BMI)",
    fill = "Diabetes Status"
  ) +
  theme_minimal(base_family = "Times New Roman") +
  theme(
    plot.title = element_text(face = "bold"),
    legend.title = element_text(face = "bold")
  )
```

```{r}
# Make BMI Category
data <- data %>%
  mutate(
    BMI_Category = case_when(
      BMI < 18.5 ~ "Underweight",
      BMI >= 18.5 & BMI < 25 ~ "Normal",
      BMI >= 25 & BMI < 30 ~ "Overweight",
      BMI >= 30 ~ "Obese"
    )
  )
```

```{r}
# Make BMI Category
data <- data %>%
  mutate(
    BMI_Category = case_when(
      BMI < 18.5 ~ "Underweight",
      BMI >= 18.5 & BMI < 25 ~ "Normal",
      BMI >= 25 & BMI < 30 ~ "Overweight",
      BMI >= 30 ~ "Obese"
    ),
    BMI_Category = factor(BMI_Category, levels = c("Underweight", "Normal", "Overweight", "Obese"))
  )
```

```{r}
# Cross-tab: BMI X Disease X Glucose
crosstab <- data %>%
  group_by(BMI_Category, Outcome) %>%
  summarise(
    Count = n(),
    Mean_Glucose = round(mean(Glucose), 1),
    .groups = "drop"
  ) %>%
  group_by(BMI_Category) %>%
  mutate(
    Percent = round(100 * Count / sum(Count), 1)  # The % of participants in BMI Category
  ) %>%
  ungroup() %>%
  mutate(
    Outcome = ifelse(Outcome == 0, "0 = No Diabetes", "1 = Diabetes")
  ) %>%
  select(BMI_Category, Outcome, Count, Percent, Mean_Glucose)

# Display as a table with simple HTML grid
knitr::kable(
  crosstab,
  format = "html",
  table.attr = 'border="1" cellpadding="5"',
  caption = "<b>Cross-tabulation of BMI Category, Diabetes Status, and Mean Glucose Levels</b>",
  col.names = c("BMI Category", "Diabetes Status", "Count", "Percent (%)", "Mean Glucose (mg/dL)")
)
  
```
<br><br><br>
